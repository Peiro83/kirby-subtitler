!function n(a,o,u){function c(e,t){if(!o[e]){if(!a[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(l)return l(e,!0);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}var r=o[e]={exports:{}};a[e][0].call(r.exports,function(t){return c(a[e][1][t]||t)},r,r.exports,n,a,o,u)}return o[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,e,i){var s="function"==typeof e.exports?e.exports.options:e.exports;s.render=function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{staticClass:"arrow",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[e("path",{attrs:{d:"M99.53,52.45a6.26,6.26,0,0,0-1.35-6.8L54.49,2a6.24,6.24,0,0,0-8.83,8.83l33,33H6.39a6.24,6.24,0,1,0,0,12.48H78.7l-33,33a6.24,6.24,0,1,0,8.83,8.83L98.18,54.49A6.23,6.23,0,0,0,99.53,52.45Z"}})])},s.staticRenderFns=[]},{}],2:[function(t,e,i){var s="function"==typeof e.exports?e.exports.options:e.exports;s.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[i("path",{attrs:{fill:"#f8f8f8",d:"M88.76,25.43V92.34A7.66,7.66,0,0,1,81.09,100H18.91a7.66,7.66,0,0,1-7.66-7.66V7.66A7.66,7.66,0,0,1,18.91,0h45Z"}}),t._v(" "),i("path",{attrs:{fill:"#c1c1c1",d:"M88.76,25.43H71.58a7.66,7.66,0,0,1-7.66-7.66V0ZM68.63,62.29h0v.26a7.13,7.13,0,1,1-3.7-6.25V40.21L42.22,44.29V76h0a7.13,7.13,0,1,1-3.7-6.51V42.75A1.85,1.85,0,0,1,40,40.93l26.41-4.75.33,0A1.85,1.85,0,0,1,68.63,38Z"}})])},s.staticRenderFns=[]},{}],3:[function(t,e,i){var s="function"==typeof e.exports?e.exports.options:e.exports;s.render=function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[e("path",{attrs:{d:"M98.35,22.5a5.5,5.5,0,0,0,0-7.86l-13-13a5.5,5.5,0,0,0-7.86,0L66.64,12.57,87.43,33.36ZM0,79.21V100H20.79L80,40.83,59.17,20Z"}})])},s.staticRenderFns=[]},{}],4:[function(t,e,i){var s="function"==typeof e.exports?e.exports.options:e.exports;s.render=function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[e("path",{attrs:{d:"M67.17,6a6,6,0,0,1,6-6H87a6,6,0,0,1,6,6V94a6,6,0,0,1-6,6H73.17a6,6,0,0,1-6-6ZM7,94a6,6,0,0,0,6,6H26.83a6,6,0,0,0,6-6V6a6,6,0,0,0-6-6H13A6,6,0,0,0,7,6Z"}})])},s.staticRenderFns=[]},{}],5:[function(t,e,i){var s="function"==typeof e.exports?e.exports.options:e.exports;s.render=function(){var t=this.$createElement,e=this._self._c||t;return e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"}},[e("path",{attrs:{d:"M87.73,42,21.46,1.42A9,9,0,0,0,7.83,9.48V90.63c0,7.31,7.66,11.72,13.63,8.05L87.73,58.12a9.53,9.53,0,0,0,0-16.11"}})])},s.staticRenderFns=[]},{}],6:[function(a,t,o){!function(){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var t=n(a(2)),e=n(a(5)),i=n(a(4)),s=n(a(3)),r=n(a(1));function n(t){return t&&t.__esModule?t:{default:t}}o.default={components:{AudioFile:t.default,PlayIcon:e.default,PauseIcon:i.default,EditIcon:s.default,ArrowIcon:r.default},data:function(){return{src:{id:"",type:"",url:""},loaded:!1,isPlaying:!1,active:null,subs:[],coords:{time:0,prop:0,text:""},currentTime:{time:0,prop:0,text:""},duration:{time:0,text:""},start:{time:0,prop:0,text:""},end:{time:0,prop:0,text:""}}},props:{storage:Object,theme:String,file:String,debug:Boolean,timelines:Object,parent:String,name:String},computed:{isAudio:function(){return"audio"==this.src.type},isVideo:function(){return"video"==this.src.type},currentPlayer:function(){return this.isAudio?this.$refs.audioPlayer:this.$refs.videoPlayer},activeTimeline:function(){return null!=this.active},activeColor:function(){return!!this.activeTimeline&&this.active.color},fileExists:function(){return this.src.url&&this.src.type},startExists:function(){return 0<this.start.time},endExists:function(){return 0<this.end.time},disableStart:function(){return!this.startExists&&this.isOverlapping},disableEnd:function(){return this.isBeforeStart||this.isAfterNextSub||this.startIsOverlapping},isOverlapping:function(){var t=!1,e=!0,i=!1,s=void 0;try{for(var r,n=this.timelineSubs(this.active)[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=r.value;if(this.currentTime.prop>=a.startprop&&this.currentTime.prop<=a.endprop){t=!0;break}}}catch(t){i=!0,s=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw s}}return t},startIsOverlapping:function(){var t=!1,e=!0,i=!1,s=void 0;try{for(var r,n=this.timelineSubs(this.active)[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=r.value;if(this.start.prop>=a.startprop&&this.start.prop<=a.endprop){t=!0;break}}}catch(t){i=!0,s=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw s}}return t},isBeforeStart:function(){return this.currentTime.time<=this.start.time},isAfterNextSub:function(){var t=this.getNextSub();return!!t&&this.currentTime.prop>=t.startprop}},created:function(){var e=this;this.$api.get(this.parent+"/sections/"+this.name).then(function(t){e.theme=t.theme,e.debug=t.debug,e.storage=t.storage,e.timelines=t.timelines,e.storage=t.storage,t.file&&(e.src.url=t.file.url,e.src.type=t.file.type),e.$subtitler.registerSubtitler(e)})},destroyed:function(){this.$subtitler.unregisterSubtitler(this)},methods:{init:function(){this.currentPlayer.addEventListener("timeupdate",this.timeUpdate),this.currentPlayer.addEventListener("loadeddata",this.loadedData),this.loaded=!0},loadedData:function(){2<=this.currentPlayer.readyState&&(this.setDuration(),this.syncCurrentTime(0))},timeUpdate:function(t){var e=this.currentPlayer.currentTime;!this.loaded&&0<e&&(this.loaded=!0),this.syncCurrentTime(e),e==this.duration.time&&this.isPlaying&&this.playPause()},playPause:function(){var t=this.currentPlayer;0==this.duration.time&&this.setDuration(),this.isPlaying?(t.pause(),this.isPlaying=!1):(t.play(),this.isPlaying=!0)},updateCoords:function(t){var e=this.$refs.timeline;if(!e)return!1;var i=e.getBoundingClientRect(),s=e.clientWidth,r=(t.clientX-i.left)/s;r=Math.max(0,Math.min(1,r.toFixed(4))),this.coords.prop=r,this.coords.time=(r*this.duration.time).toFixed(2),this.coords.text=this.formatTime(this.coords.time)},onHandleMouseDown:function(t){document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp)},onDocumentMouseUp:function(t){document.removeEventListener("mouseup",this.onDocumentMouseUp),document.removeEventListener("mousemove",this.onDocumentMouseMove),this.syncProgress(t)},onDocumentMouseMove:function(t){this.syncProgress(t)},syncProgress:function(t){this.currentTime.prop=this.coords.prop,this.currentTime.time=(this.coords.prop*this.duration.time).toFixed(2),this.currentTime.text=this.formatTime(this.coords.time),this.currentPlayer.currentTime=this.currentTime.time},setStart:function(){this.startExists?(this.resetStart(),this.resetEnd()):(this.start.prop=this.currentTime.prop,this.start.text=this.currentTime.text,this.start.time=this.currentTime.time)},setEnd:function(){this.end.prop=this.currentTime.prop,this.end.text=this.currentTime.text,this.end.time=this.currentTime.time;var t={start:this.start.time,startprop:this.start.prop,end:this.end.time,endprop:this.end.prop,timeline:this.active.id},e=this.getNewIndex();console.log(e),this.subs.splice(e,0,t),this.updateStructure(),this.resetStart(),this.resetEnd()},getNextSub:function(){var e=this;return this.timelineSubs(this.active).find(function(t){return t.startprop>=e.start.prop})},getPrevSub:function(){var e=this;return this.timelineSubs(this.active).splice(0).reverse().find(function(t){return e.start.prop>t.endprop})},getNewIndex:function(){var e=this;if(!this.subs.length)return 0;if(this.timelineSubs(this.active).length){var t=this.getNextSub();if(t)return this.subs.indexOf(t);var i=this.getPrevSub();return this.subs.indexOf(i)+1}if(0==this.timelines.indexOf(this.active))return 0;var s=this.timelines.slice(this.timelines.indexOf(this.active)+1);if(!s)return this.subs.length;if(s){var r=s.filter(function(t){return e.timelineSubs(t).length});if(r.length){var n=r[0],a=this.timelineSubs(n)[0];return this.subs.indexOf(a)}return this.subs.length}},resetStart:function(){this.start.prop=0,this.start.text=0,this.start.time=0},resetEnd:function(){this.end.prop=0,this.end.text=0,this.end.time=0},setDuration:function(){var t=this.currentPlayer;this.duration.time=t.duration,this.duration.text=this.formatTime(t.duration)},syncCurrentTime:function(t){this.currentTime.time=t,this.currentTime.prop=t/this.duration.time,this.currentTime.text=this.formatTime(t)},setActive:function(t){this.active==t?(this.active=null,this.resetStart(),this.resetEnd()):this.active=t},timelineSubs:function(e){return this.subs.filter(function(t){return t.timeline==e.id})},formatTime:function(t){var e=Math.floor(t);return(e-(e%=60))/60+(9<e?"'":"'0")+e},syncSrcType:function(){var t=this,e=this.src.url.split(".").pop();-1<["avi","flv","m4v","mov","movie","mpe","mpg","mp4","ogg","ogv","swf","webm"].indexOf(e)&&(this.src.type="video"),-1<["aif","aiff","m4a","midi","mp3","wav"].indexOf(e)&&(this.src.type="audio"),this.src.type&&!this.loaded&&this.$nextTick(function(){t.init()})},setValue:function(t,e){var i=this;try{for(var s in this.storage)if(this.storage[s]===t)switch(s){case"src":this.loaded=!1,Array.isArray(e)&&e.length?(this.src={id:e[0].id,url:e[0].url,type:e[0].type},this.src.type||this.syncSrcType()):this.src={id:"",url:"",type:""};break;case"subs":if(!Array.isArray(e)){console.warn("could not adapt field to markers datapoint, not an array: ",e);break}this.subs=e.map(function(t){return{timeline:t.timeline,start:t.start,startprop:t.startprop,end:t.end,endprop:t.endprop}});break;default:this[s]=e}this.src.type&&!this.loaded&&this.$nextTick(function(){i.init()})}catch(t){console.warn(t)}},updateStructure:function(){this.storage.subs&&this.$subtitler.updateFields("subs",this.storage.subs,this.subs)}}}}(),t.exports.__esModule&&(t.exports=t.exports.default);var e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var i=this,t=i.$createElement,s=i._self._c||t;return s("div",{staticClass:"subtitler",attrs:{"data-theme":i.theme,"data-color":i.activeColor},on:{mousemove:i.updateCoords}},[s("div",{staticClass:"subtitler-background"}),i._v(" "),i.fileExists?i._e():s("div",{staticClass:"subtitler-placeholder"},[s("div",{staticClass:"subtitler-placeholder-ctn"},[i._v("\n\t\t\tPlease select a file\n\t\t")])]),i._v(" "),i.debug&&i.fileExists?s("div",{staticClass:"subtitler-toolbar"},[s("div",{staticClass:"subtitler-toolbar-debug"},[s("div",{staticClass:"coord prop"},[i._v(i._s(i.coords.prop))]),i._v(" "),s("div",{staticClass:"coord time"},[i._v(i._s(i.coords.time))]),i._v(" "),s("div",{staticClass:"coord text"},[i._v(i._s(i.coords.text))])])]):i._e(),i._v(" "),i.fileExists?s("div",{class:["subtitler-file",{debug:i.debug}]},[i.isVideo?s("div",{staticClass:"subtitler-video"},[s("div",{staticClass:"subtitler-video-ctn"},[s("video",{ref:"videoPlayer"},[s("source",{attrs:{src:i.src.url}})])])]):i._e(),i._v(" "),i.isAudio?s("div",{staticClass:"subtitler-audio"},[s("div",{staticClass:"audio-icon"},[s("audio-file")],1),i._v(" "),s("audio",{ref:"audioPlayer"},[s("source",{attrs:{src:i.src.url}})])]):i._e()]):i._e(),i._v(" "),i.fileExists?s("div",{staticClass:"subtitler-editor"},[s("div",{staticClass:"subtitler-editor-firstline"},[s("div",{staticClass:"left"},[s("div",{staticClass:"play",on:{click:i.playPause}},[i.isPlaying?i._e():s("play-icon"),i._v(" "),i.isPlaying?s("pause-icon"):i._e()],1),i._v(" "),i.activeTimeline?s("div",{staticClass:"range-buttons"},[s("div",{class:["range-button start",{disabled:i.disableStart},{active:i.startExists}],on:{click:i.setStart}},[i._v("{")]),i._v(" "),i.startExists?s("arrow-icon"):i._e(),i._v(" "),i.startExists?s("div",{staticClass:"range-button end",class:["range-button end",{disabled:i.disableEnd}],on:{click:i.setEnd}},[i._v("}")]):i._e()],1):i._e()]),i._v(" "),s("div",{ref:"timeline",staticClass:"right"},[s("div",{staticClass:"duration"},[i._v(i._s(i.duration.text))])])]),i._v(" "),s("div",{staticClass:"subtitler-editor-timelines"},i._l(i.timelines,function(e,t){return s("div",{class:["timeline",{active:e==i.active},{inactive:i.activeTimeline&&e!=i.active}],attrs:{"data-theme":e.color}},[s("div",{staticClass:"left"},[s("div",{staticClass:"tick-wrapper"},[s("div",{staticClass:"tick",on:{click:function(t){i.setActive(e)}}},[s("edit-icon")],1)]),i._v(" "),s("div",{staticClass:"name"},[i._v(i._s(e.label))]),i._v(" "),s("div",{staticClass:"count-wrapper"},[s("div",{staticClass:"count"},[i._v(i._s(i.timelineSubs(e).length))])])]),i._v(" "),s("div",{staticClass:"right"},[s("div",{staticClass:"subs"},i._l(i.timelineSubs(e),function(t,e){return s("div",{staticClass:"sub",style:"left:"+100*t.startprop+"%; width:"+100*(t.endprop-t.startprop)+"%;"},[s("div",{staticClass:"index"},[i._v(i._s(i.subs.indexOf(t)+1))])])}))])])})),i._v(" "),s("div",{staticClass:"subtitler-editor-progress"},[""!=i.currentTime.text?s("div",{staticClass:"bar",style:"width:"+100*i.currentTime.prop+"%;"},[s("div",{staticClass:"handle",on:{mousedown:i.onHandleMouseDown}}),i._v(" "),s("div",{staticClass:"current-time"},[i._v(i._s(i.currentTime.text))])]):i._e()]),i._v(" "),s("div",{staticClass:"subtitler-editor-range"},[i.startExists?s("div",{staticClass:"start",style:"left:"+100*i.start.prop+"%;"},[s("div",{staticClass:"start-time"},[i._v(i._s(i.start.text))])]):i._e(),i._v(" "),i.endExists?s("div",{staticClass:"end",style:"left:"+100*i.end.prop+"%;"},[s("div",{staticClass:"end-time"},[i._v(i._s(i.end.text))])]):i._e()])]):i._e()])},e.staticRenderFns=[]},{1:1,2:2,3:3,4:4,5:5}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(i){i.prototype.$subtitler=new i({data:function(){return{fields:[],Subtitlers:[],updatingSubtitlers:!1,updatingFields:!1}},methods:{getAcceptedType:function(t){var e=i.options.components["k-"+t.type+"-field"];return e?e.options.props.value.type:(console.warn('Subtitler could not update form: Unknown field type "'+t.type+'"'),null)},updateFields:function(i,s,r){var n=this;this.updatingSubtitlers||(this.updatingFields=!0,this.fields.forEach(function(t){if(s in t.fields){if(!n.getAcceptedType(t.fields[s]))return;switch(i){case"sub":var e=t.fields[s].fields;t.values[s]=e?r.map(function(t){return t=Object.assign({},t)}):r;break;default:t.values[s]=r}t.input(t.values)}}),this.$nextTick(function(){return n.updatingFields=!1}))},updateSubtitlers:function(s){var t=this;this.updatingFields||(this.updatingSubtitlers=!0,this.Subtitlers.forEach(function(t){for(var e in s){var i=s[e];t.setValue(e,i)}}),this.$nextTick(function(){return t.updatingSubtitlers=!1}))},registerSubtitler:function(t){this.Subtitlers.push(t)},unregisterSubtitler:function(t){var e=this.fields.indexOf(t);-1!==e&&this.Subtitlers.splice(e,1)},registerFields:function(t){this.fields.push(t)},unregisterFields:function(t){var e=this.fields.indexOf(t);-1!==e&&this.fields.splice(e,1)}}});var e=i.options.components["k-fields-section"];i.component("k-fields-section",{extends:e,created:function(){this.$subtitler.registerFields(this)},destroyed:function(){this.$subtitler.unregisterFields(this)},methods:{input:function(t){this.values=t,e.options.methods.input.call(this,t),this.$subtitler.updateSubtitlers(t)}},watch:{values:function(t){this.$subtitler.updateSubtitlers(t)}}})}},{}],8:[function(t,e,i){"use strict";var s=n(t(6)),r=n(t(7));function n(t){return t&&t.__esModule?t:{default:t}}panel.plugin("sylvainjule/subtitler",{use:[r.default],sections:{subtitler:s.default}})},{6:6,7:7}]},{},[8]);
